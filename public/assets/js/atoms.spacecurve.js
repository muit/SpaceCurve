(function(){"use strict";var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;__.Entity.GameItem=function(_super){function GameItem(){return GameItem.__super__.constructor.apply(this,arguments)}return __extends(GameItem,_super),GameItem.fields("id","name","players","status"),GameItem.prototype.parse=function(){return{text:this.name,description:this.status,info:this.players}},GameItem}(Atoms.Class.Entity),__.Entity.New=function(_super){function New(){return New.__super__.constructor.apply(this,arguments)}return __extends(New,_super),New.fields("id","name","text","date"),New.prototype.parse=function(){return{text:this.name,description:this.text,info:this.date}},New}(Atoms.Class.Entity),__.Entity.Player=function(_super){function Player(){return Player.__super__.constructor.apply(this,arguments)}return __extends(Player,_super),Player.fields("id","name","score","color"),Player.prototype.parse=function(){return{image:this.color,text:this.name,info:this.score}},Player}(Atoms.Class.Entity),Atoms.Organism.Game=function(_super){function Game(){return Game.__super__.constructor.apply(this,arguments)}return __extends(Game,_super),Game.scaffold("assets/scaffold/game.json"),Game.prototype.join=function(entity){return this.entity=entity,network.joinGame(this.entity.id,function(data){return data.error!==!0?Atoms.Url.path("game/canvas"):void 0})},Game.prototype.create=function(entity){return this.entity=entity,network.createGame(this.entity.name,function(data){return data.error!==!0?Atoms.Url.path("game/canvas"):void 0})},Game.prototype.onExitGame=function(){var atom,dispatcher,hierarchy;return atom=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],network.exitGame(function(data){return console.log(data.msg),Atoms.Url.path("game_list/games")})},Game}(Atoms.Organism.Article),new Atoms.Organism.Game,Atoms.Organism.Game_list=function(_super){function Game_list(){Game_list.__super__.constructor.apply(this,arguments),this.bind("show",this.load)}return __extends(Game_list,_super),Game_list.scaffold("assets/scaffold/game_list.json"),Game_list.prototype.load=function(){return __.Entity.GameItem.destroyAll(),network.getGames(function(data){var game,status,_i,_len,_ref,_results;if(data.error===!1){for(console.log(data.games.length),_ref=data.games,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)game=_ref[_i],status=game.playing?"Playing":"Waiting",_results.push(__.Entity.GameItem.create({id:game.id,name:game.name,players:game.playerAmount,status:status}));return _results}return console.log(data.msg)})},Game_list.prototype.onButtonTouch=function(){var dispatcher,event,hierarchy;event=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[]},Game_list.prototype.onGameItem=function(){var atom,dispatcher,hierarchy;return atom=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],__.Article.Game.join(atom.entity)},Game_list.prototype.onRandomGame=function(){var atom,dispatcher,hierarchy,length,random;return atom=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],(length=__.Entity.GameItem.all().length)>0?(random=Math.floor(Math.random()*(length-1)),__.Article.Game.join(__.Entity.GameItem.findBy("id",random))):void 0},Game_list.prototype.onCreateGame=function(){var atom,dispatcher,hierarchy,id;return atom=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],id=__.Entity.GameItem.count(),__.Article.Game.create(__.Entity.GameItem.create({id:id,name:"Name!",players:"0/6",status:"Waiting"}))},Game_list}(Atoms.Organism.Article),new Atoms.Organism.Game_list,Atoms.Organism.Info=function(_super){function Info(){return Info.__super__.constructor.apply(this,arguments)}return __extends(Info,_super),Info.scaffold("assets/scaffold/info.json"),Info}(Atoms.Organism.Aside),new Atoms.Organism.Info,Atoms.Organism.Login=function(_super){function Login(){return Login.__super__.constructor.apply(this,arguments)}return __extends(Login,_super),Login.scaffold("assets/scaffold/login.json"),Login.prototype.onButtonTouch=function(){var dispatcher,event,hierarchy;event=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[]},Login}(Atoms.Organism.Aside),new Atoms.Organism.Login,Atoms.Organism.Main=function(_super){function Main(){return Main.__super__.constructor.apply(this,arguments)}return __extends(Main,_super),Main.scaffold("assets/scaffold/main.json"),Main.prototype.onGameList=function(){var dispatcher,event,hierarchy;return event=arguments[0],dispatcher=arguments[1],hierarchy=3<=arguments.length?__slice.call(arguments,2):[],network.logged?Atoms.Url.path("game_list/games"):console.log("You need to be logged to play!")},Main}(Atoms.Organism.Article),new Atoms.Organism.Main,Atoms.$(function(){return console.log("------------------------------------------------------------"),console.log("Atoms v"+Atoms.version+" (Atoms.App v"+Atoms.App.version+")"),console.log("------------------------------------------------------------"),Atoms.Url.path("main/news"),"undefined"!=typeof Appnima&&null!==Appnima?Appnima.key="null":void 0}),__.proxy=function(type,method,parameters,background){var promise,token;return null==parameters&&(parameters={}),null==background&&(background=!1),promise=new Hope.Promise,background||__.Modal.Loading.show(),token="undefined"!=typeof session&&null!==session?session.token:null,$$.ajax({url:""+method,type:type,data:parameters,contentType:"application/x-www-form-urlencoded",dataType:"json",headers:{Authorization:token},success:function(response){return background||__.Modal.Loading.hide(),promise.done(null,response)},error:function(){return function(xhr,error){return background||__.Modal.Loading.hide(),error={code:error.status,message:error.response},console.error("__.proxy [ERROR "+error.code+"]: "+error.message),promise.done(error,null)}}(this)}),promise}}).call(this);